/* --------------------------------------------------------------------------
   Usage example

   <div class="u-grid-row">
     <div class="u-col-12 u-col-desktop-6">Item 1</div>
     <div class="u-col-12 u-col-desktop-6">Item 2</div>
   </div>

   - Creates a 12-column grid
   - Columns stack by default and split at defined breakpoints (tablet-up, desktop-up, etc.)
   - Grid gap uses spacing tokens (see spacing utilities)
   - Centering (The 13-Line Rule):
     - Use .u-col-[size]-center (e.g., .u-col-desktop-6-center).
     - Automatically applies the formula: Start Line = ((12 - Width) / 2) + 1.
   -------------------------------------------------------------------------- */

@use 'sass:math';
@use '../mixins/breakpoint' as *;
@use '../abstracts/scales' as *;

/* --------------------------------------------------------------------------
   Configuration
   -------------------------------------------------------------------------- */

$grid-columns: 12 !default;
$grid-gap: var(--space-4) !default; // 16px default

/* --------------------------------------------------------------------------
   Grid container
   -------------------------------------------------------------------------- */

.u-grid-row {
  --gap: #{$grid-gap};
  --grid-row-gap: var(--row-gap, var(--gap));
  --grid-column-gap: var(--column-gap, var(--gap));

  display: grid;
  grid-template-columns: repeat(#{$grid-columns}, minmax(0, 1fr));
  gap: var(--grid-row-gap) var(--grid-column-gap);

  > [class*='u-col-'] {
    grid-column: span #{$grid-columns};
  }

  @each $key, $val in $space-scale {
    &.u-gap-#{$key} {
      --gap: #{$val};
    }

    &.u-col-gap-#{$key} {
      --column-gap: #{$val};
    }

    &.u-row-gap-#{$key} {
      --row-gap: #{$val};
    }
  }

  /* --------------------------------------------------------------------------
    Mixin: Grid Columns
    -------------------------------------------------------------------------- */

  /* stylelint-disable declaration-block-no-redundant-longhand-properties */

  @mixin make-grid-columns($infix: null) {
    $prefix: if($infix, '-#{$infix}', '');

    > .u-col#{$prefix}-full {
      grid-column-start: 1;
      grid-column-end: -1;
    }

    @for $i from 1 through $grid-columns {
      > .u-col#{$prefix}-#{$i} {
        grid-column-start: auto;
        grid-column-end: span #{$i};
      }

      @if ($grid-columns - $i) % 2 == 0 {
        > .u-col#{$prefix}-#{$i}-center {
          grid-column-end: span #{$i};
          grid-column-start: #{math.div($grid-columns - $i, 2) + 1};
        }
      }
    }

    @for $i from 1 through $grid-columns {
      > .u-col-start#{$prefix}-#{$i} {
        grid-column-start: #{$i};
      }
    }

    > .u-col-end#{$prefix}-last {
      grid-column-end: -1;
    }
  }

  /* stylelint-enable declaration-block-no-redundant-longhand-properties */

  /* --------------------------------------------------------------------------
    Column span utilities
    -------------------------------------------------------------------------- */

  /* Base: < 768px (mobile) */
  @include make-grid-columns;

  /* Tablet and up: ≥ 768px */
  @include breakpoint-up(tablet) {
    @include make-grid-columns('tablet');
  }

  /* Desktop and up: ≥ 1024px */
  @include breakpoint-up(desktop) {
    @include make-grid-columns('desktop');
  }

  /* Wide and up: ≥ 1280px */
  @include breakpoint-up(wide) {
    @include make-grid-columns('wide');
  }

  /* Ultra-wide and up: ≥ 1536px */
  @include breakpoint-up(ultrawide) {
    @include make-grid-columns('ultrawide');
  }
}

/* --------------------------------------------------------------------------
   Auto-fit / Auto-fill grid helpers
   -------------------------------------------------------------------------- */

/* Default minimum column width */
$grid-auto-min: 16rem !default;

/* Auto-fit: collapses empty tracks */
.u-grid-auto-fit {
  grid-template-columns: repeat(auto-fit, minmax(var(--grid-auto-min, #{$grid-auto-min}), 1fr));
}

/* Auto-fill: preserves empty tracks */
.u-grid-auto-fill {
  grid-template-columns: repeat(auto-fill, minmax(var(--grid-auto-min, #{$grid-auto-min}), 1fr));
}
